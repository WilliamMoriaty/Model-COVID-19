fig2=figure(1)
clf();
set(gcf,'position',[100,200,720,540])
load('Dataset2')
subplot(2,2,1)
A0=PD1CD8_HC;A1=PD1CD8_Mild;A2=PD1CD8_Severe;
n0=size(A0);n1=size(A1);n2=size(A2);
P=[A0;A1;A2];
X0=datashift(1,A0');
plot(X0(:,1),X0(:,2),'^','markersize',2.5,'Markerfacecolor',[0.16,0.74,0.95],'MarkerEdgecolor',[0.16,0.74,0.95]);
hold on
X1=datashift(2,A1');
plot(X1(:,1),X1(:,2),'.','markersize',12,'color',[0.20,0.72,0.04]);
hold on
X2=datashift(3,A2');
plot(X2(:,1),X2(:,2),'s','markersize',5,'Markerfacecolor',[0.81,0.11,0.10],'MarkerEdgecolor',[0.81,0.11,0.10]);

g2=repmat({'Severe'},[n2,1]);
g1=repmat({'Mild'},[n1,1]);
g0=repmat({'HC'},[n0,1]);
g=[g0;g1;g2];
h=boxplot(P,g,'Symbol','w','Widths',0.75);
set(h,'LineWidth',1.2)
set(h(:,1),'color',[0.16,0.74,0.95])
set(h(:,2),'color',[0.20,0.72,0.04])
set(h(:,3),'color',[0.81,0.11,0.10])
ylim([0,80])
ylabel('%')
set(gca,'linewidth',1.2,'FontSize',10,'FontWeight','bold','ytick',...
    0:20:80)
title('PD-1+CD8+ T cells','FontWeight','bold','FontSize',10)
annotation(fig2,'textbox',...
    [0.291111111111111 0.825185185185187 0.121111111111111 0.0562962962962956],...
    'String','P=9.82\times10^{-4}',...
    'FontWeight','bold',...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(fig2,'line',[0.32 0.387777777777779],...
    [0.831111111111111 0.831111111111112],'LineWidth',1.2);
annotation(fig2,'textbox',...
    [0.222111111111111 0.795555555555556 0.0723333333333333 0.0474074074074089],...
    'String','P=0.95',...
    'FontWeight','bold',...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(fig2,'line',[0.226666666666667 0.291111111111111],...
    [0.803444444444445 0.802962962962963],'LineWidth',1.2);
annotation(fig2,'textbox',...
    [0.258777777777778 0.860740740740742 0.087888888888889 0.0459259259259254],...
    'String','P=0.032',...
    'FontWeight','bold',...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(fig2,'line',[0.214444444444444 0.392222222222222],...
    [0.86862962962963 0.868148148148148],'LineWidth',1.2);
box off

subplot(2,2,2)
A0=PD1CD4_HC;A1=PD1CD4_Mild;A2=PD1CD4_Severe;
n0=size(A0);n1=size(A1);n2=size(A2);
P=[A0;A1;A2];
X0=datashift(1,A0');
plot(X0(:,1),X0(:,2),'^','markersize',2.5,'Markerfacecolor',[0.16,0.74,0.95],'MarkerEdgecolor',[0.16,0.74,0.95]);
hold on
X1=datashift(2,A1');
plot(X1(:,1),X1(:,2),'.','markersize',12,'color',[0.20,0.72,0.04]);
hold on
X2=datashift(3,A2');
plot(X2(:,1),X2(:,2),'s','markersize',5,'Markerfacecolor',[0.81,0.11,0.10],'MarkerEdgecolor',[0.81,0.11,0.10]);

g2=repmat({'Severe'},[n2,1]);
g1=repmat({'Mild'},[n1,1]);
g0=repmat({'HC'},[n0,1]);
g=[g0;g1;g2];
h=boxplot(P,g,'Symbol','w','Widths',0.75);
set(h,'LineWidth',1.2)
set(h(:,1),'color',[0.16,0.74,0.95])
set(h(:,2),'color',[0.20,0.72,0.04])
set(h(:,3),'color',[0.81,0.11,0.10])
ylim([0,80])
% ylabel('%')
set(gca,'linewidth',1.2,'FontSize',10,'FontWeight','bold','ytick',...
    0:20:80)
title('PD-1+CD4+ T cells','FontWeight','bold','FontSize',10)
annotation(fig2,'textbox',...
    [0.752111111111111 0.826666666666668 0.0801111111111109 0.0400000000000013],...
    'String','P=0.12',...
    'FontWeight','bold',...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(fig2,'line',[0.76 0.826666666666667],...
    [0.826666666666667 0.826666666666667],'LineWidth',1.2);
annotation(fig2,'textbox',...
    [0.661 0.82962962962963 0.0756666666666663 0.0385185185185204],...
    'String','P=0.30',...
    'FontWeight','bold',...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(fig2,'line',[0.667777777777778 0.73],...
    [0.82862962962963 0.828148148148148],'LineWidth',1.2);
annotation(fig2,'textbox',...
    [0.712111111111111 0.86962962962963 0.0823333333333333 0.0400000000000015],...
    'String','P=0.75',...
    'FontWeight','bold',...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(fig2,'line',[0.667777777777778 0.826666666666667],...
    [0.867148148148148 0.865185185185185],'LineWidth',1.2);
box off

load('Single_cell_RNA_Sequence.mat')
% axes('position',[0.532,0.150,0.155,0.326])
subplot(2,2,3)
x=0:0.05:4;
A1=PDCD1_Treg_moderate(find(PDCD1_Treg_moderate>0));
n=size(A1,1);
[u1,x]=hist(A1,x);
plot(x,100*u1/n,'b-','linewidth',1.2);
hold on
A2=PDCD1_Treg_critical(find(PDCD1_Treg_critical>0));
n=size(A2,1);
[u,x]=hist(A2,x);
plot(x,100*u/n,'r-','linewidth',1.2);
ylim([0 8])
xlabel('Expression level (scale)','FontName','Helvetica','FontSize',10,'FontWeight','bold')
ylabel('%')
set(gca,'FontName','Helvetica','FontSize',10,'FontWeight','bold','linewidth',1.2)
title('PD-1 in CD4T/Treg cell','FontName','Helvetica','FontSize',10,'FontWeight','bold')
leg=legend({'Moderate','Critical'},'FontName','Helvetica','FontSize',10,'FontWeight','bold');
leg.ItemTokenSize = [10,3];
legend('boxoff')
box off

% axes('position',[0.742,0.150,0.155,0.326])
subplot(2,2,4)
x=0:0.05:4;
A1=PDCD1_CTL_moderate(find(PDCD1_CTL_moderate>0));
n=size(A1,1);
[u1,x]=hist(A1,x);
plot(x,100*u1/n,'b-','linewidth',1.2);
hold on
A2=PDCD1_CTL_critical(find(PDCD1_CTL_critical>0));
n=size(A2,1);
[u,x]=hist(A2,x);
plot(x,100*u/n,'r-','linewidth',1.2);
ylim([0 8])
xlabel('Expression level (scale)','FontName','Helvetica','FontSize',10,'FontWeight','bold')
set(gca,'FontSize',10,'FontName','Helvetica','FontSize',10,'FontWeight','bold','linewidth',1.2)
title('PD-1 in CTL cell','FontName','Helvetica','FontSize',10,'FontWeight','bold')
leg=legend({'Moderate','Critical'},'FontName','Helvetica','FontSize',10,'FontWeight','bold');
leg.ItemTokenSize = [10,3];
legend('boxoff')
box off

annotation(fig2,'textbox',...
    [0.0379 0.879 0.0379 0.0785],...
    'String',{'a'},...
    'FontWeight','bold',...
    'FontSize',18,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(fig2,'textbox',...
    [0.0379 0.410 0.0379 0.0785],...
    'String',{'c'},...
    'FontWeight','bold',...
    'FontSize',18,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(fig2,'textbox',...
    [0.4773 0.879 0.0379 0.0785],...
    'String',{'b'},...
    'FontWeight','bold',...
    'FontSize',18,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(fig2,'textbox',...
    [0.4773 0.410 0.0379 0.0785],...
    'String',{'d'},...
    'FontWeight','bold',...
    'FontSize',18,...
    'FitBoxToText','off',...
    'EdgeColor','none');

exportfig(fig2,'Supfig1.eps','color','cmyk','fontmode','scaled','fontsize',1);

function X=datashift(k,U)
n=size(U,2);
X=zeros(n,2);
for i=1:n
    X(i,1) = k + 0.5*(rand()-0.5);
    X(i,2) = U(i);
end
end